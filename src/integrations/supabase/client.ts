
// This file is automatically generated. Do not edit it directly.
import { createClient } from '@supabase/supabase-js';
import type { Database } from './types';

const SUPABASE_URL = "https://vcywiyvbfrylffwfzsny.supabase.co";
const SUPABASE_PUBLISHABLE_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InZjeXdpeXZiZnJ5bGZmd2Z6c255Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3Mzc0ODA3MDIsImV4cCI6MjA1MzA1NjcwMn0.rZUZjLf4j6h0lhl53PhKJ0eARsBXdmlPOtIAHTJQxNE";

// Import the supabase client like this:
// import { supabase } from "@/integrations/supabase/client";

export const supabase = createClient<Database>(SUPABASE_URL, SUPABASE_PUBLISHABLE_KEY);

// Add a helper function to enable realtime on tables we need
export const enableRealtimeForTables = () => {
  supabase.channel('schema-db-changes')
    .on('postgres_changes', { event: '*', schema: 'public', table: 'post_reactions' }, (payload) => {
      console.log('Reaction changes detected', payload);
    })
    .on('postgres_changes', { event: '*', schema: 'public', table: 'post_bludifies' }, (payload) => {
      console.log('Bludify changes detected', payload);
    })
    .on('postgres_changes', { event: '*', schema: 'public', table: 'post_bookmarks' }, (payload) => {
      console.log('Bookmark changes detected', payload);
    })
    .on('postgres_changes', { event: '*', schema: 'public', table: 'notifications' }, (payload) => {
      console.log('Notification changes detected', payload);
    })
    .subscribe();
};

// Helper function to convert arrays to JSON strings for Supabase storage
export const prepareArrayField = (field: string[]): string => {
  return JSON.stringify(field);
};

// Helper function to parse JSON strings from Supabase to arrays
export const parseArrayField = (field: string | null): string[] => {
  if (!field) return [];
  try {
    // Try to parse as JSON array
    const parsed = JSON.parse(field);
    return Array.isArray(parsed) ? parsed : [field];
  } catch (error) {
    // If it's not valid JSON, return it as a single item array
    return [field];
  }
};
